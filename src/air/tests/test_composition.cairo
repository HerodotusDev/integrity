use cairo_verifier::air::{
    composition::eval_composition_polynomial, public_input::{PublicInput, SegmentInfo},
    public_memory::AddrValue, global_values::InteractionElements,
};
use cairo_verifier::vector_commitment::vector_commitment::{
    VectorCommitment, VectorCommitmentConfig
};
use cairo_verifier::table_commitment::table_commitment::{TableCommitment, TableCommitmentConfig};
use cairo_verifier::tests::stone_proof_fibonacci;

#[test]
#[available_gas(9999999999)]
fn test_eval_composition_polynomial() {
    let public_input = stone_proof_fibonacci::public_input::get();
    let interaction_elements = stone_proof_fibonacci::interaction_elements::get();
    let mask_values = stone_proof_fibonacci::stark::oods_values::get();
    let constraint_coefficients = array![
        0x1,
        0x6188c47c2623bdc3d32f510746277511b4a85cd1167a65bd35b3d6030d7399e,
        0x7f74cde52b3f01d21122f2bbb9a1e473cc79543739e19a25b075a1df340f3a7,
        0x529488f1637448d5e2b4964be2d5e3948d6462baed0e8b90a29fc11e334555c,
        0x28b7f10a39a7062ae17109c7e7376c62d1da6afb8ede0bc90a26c55cfd9fe22,
        0x38c46256b4e367a442af7854359a465659ba2ae88c6135a817088333147b1f2,
        0x67c17cd4c03866826fa031256fda63f3862ab07b9dfcaa074a412c5806b47ae,
        0x5d290b4dc97984c17bbe6df38feb8e80cdd76bd820ecc31d3597bfc13fafb01,
        0x5c84ebd3d49ae0cd8b182871c4d9bd590c4b2de30fd9b19e8ef2671114e3a09,
        0x737768fef4a747c7449e00196aab4afe2ecc43b469bc15d13da25ae31bdc0c4,
        0x8941830f41a5ab13edc4f200188b5db9d77df4148823a989efaa14f998c2a3,
        0x6a29210c51fd5fa366281d04304f978492edaceea55c4cc1b67eac95da7adf,
        0x3663a0085e815dec0b7ec1829ddb0b2a8c3fd58074ca939dece303908e5690f,
        0x377ee8287afaf0ce4f3169eb61e525f38d5a6bd26ae549b8d8e975fa6b608ba,
        0x657899aaed291ed50d26aeeebf96d066e951e0b0fb6a23201b641b23ac8adf1,
        0x7005146199fcb5326a2d6cb0d35a1579ee1f5d8672f7ecae6b3e4d59a84398a,
        0x1ba52c3b492eb5d6879412c684c4ec7416e7be9b95ce0e79a962fe19420702a,
        0x479b1f289fc8af280a79c0940f08debf7d3882a9ea341d637af55c7119e2ef7,
        0x42afeb86b04257a6892f7a57d3f5736508a40aa01689a83494e49c377d9a1c6,
        0x3ef08d78dab7dd3806c457271ca76a8dc329739de8b7cef8b5add374f8b3cb7,
        0x76cae4663895669328593a4f70bb9000f09291ac1318d2a6232ea0264489fff,
        0x4574d3e23227e08fe2c560afbb78e12f433f2d0aea8285775c58e3345e67e03,
        0x4e4cdc060eeabfadc2b59d54afc257acab2989d7bc69c142686e14d5e2c5176,
        0x4e0bd03bb90fc18377dcc4b3fe20a5ee301ee7c8dc513c496e6b45243d8e02,
        0x51669c8e9b47f34d90eb78fe136543c0ae4d05e3544df23375c5568cff73967,
        0x7aac1567c48c415fa1c6e54aeb4fb4301fda031f580fe553f288e86fc4d1a81,
        0x71953fbddb2f049b5838bf5722847b40b618a5ad198bdbbf18ca49ba95cc108,
        0x1a08d8643a9b811e7f32d19651d019cf7cf07ead69803ebdff5ed6269b5ce6c,
        0x760ebf87d000d09e8dead6084da672a6842a4e229446270e70b4acb294736b3,
        0x1836dfbbc5f4777e695689ae05317eb38f9e6267101aa01912e10a6fc207691,
        0x1033395d04e44bce46ce210a93af13fd3092a7ddfa74ce993aa6ddc37336e88,
        0x6c4765e7b19457dc8f95f5a486239034791ed243ec5fef90a554fb908b31a86,
        0x1260e69f97408eb6bf4e1bf3c50178951656c8c694c95aca0cfb72c9adc1b97,
        0x4a8b3f2f9267c2ee3725795092cbe0ac985ca8472b3ce56e8852b6644400406,
        0x49bc378f2acda1001cd44e01d37f8952fe8e8df57ac0efc5a48d705567fddb4,
        0x28c1102448f6e37067695fd4ee8c9a2fb4dc515589ca78bfb2eca7864dd8fdf,
        0x3eb4146573f28050bc85da608c2637963210cf62af34482b039b9d78b7f35b2,
        0x144812300f0f63b8b34577a799e192609c4008d7e64885cf842cc3e2f0993b,
        0x64c93b56c42c8be7e7cbc1785d46da53cb8f478001b35f1a130b13940320043,
        0x26c9a2e5eab9aab16a27a30dbc51bdaa9af594e495a9694517f60a5d4794f48,
        0x152a27322e10b462e36047a928e5e75bedef98649ddaa32e9e4d72ec9cac894,
        0x512ad08d8e7b37525d1c0eac7c4516aab14aa94981dbf48b0d9552f963ad8,
        0x101a918384dfbbcbe3113aece146fe0e8fc422421f21d61ab96e86723077ca0,
        0x61202fbd707d222caaf523794f73a01e125cfb3fe0bc173a35acfb667117e44,
        0x4181b6674fb0174d4ba6ddc5b8954910e43559f217547f61ca69a7d990f28b8,
        0x1d0305d85e192fad1686ee750e041df4a5304062fbebfed9971fc82167c4477,
        0x6269741c8c3b53d030982216f718b77668a2a15c889c2a89c8ab27a736c735b,
        0x4034bb2fff05e7c13f67d47cd85e766b143efe03f17ead2287d7516b37907b,
        0x3000c594c641deb02c1ceb216f59f13bba02cd6ae58672651ee5e41101efca2,
        0xe184a63189456d0ebee7c50d7b4845d59d614637fa36316687b4ed97583e57,
        0x5ddc6944385449881ee401fd08dc5539904a76697f938da14131cb9adeefdb4,
        0x30f07c3f80f4c5c7eea679838ad90c3d4af0b7c22275a71f360b31849a369ab,
        0x6d07a46da5af6bb30fff79b2a013c982c495f0fab553139caf6ed40e65b25a9,
        0x5baa502d958ee79a5a4f13f113f686427cd8119a1343ce7f831af001dcb76d3,
        0x2001b6aec1331095f802b8a914804a2aca26fed1913f36fbdebf475c31bec73,
        0x498646e98ebb0b22f03a33e1bce45d58c07a2454441cbd89065306dd0886349,
        0xda9b65fa7d976bdc3a794da258dfeec1c46f00e246ddb281ef10b004d2adcc,
        0xbee2ec219c7d858387520c72905b1bf42d67141364abf04d45932eb87b4d29,
        0x1cfffa960459a3e433afb66fe0756d4f1e9d9c20de3982e35d693c7b01af451,
        0x5c84b799b2c0eca6b35d8ec24a8eb4a73601d787f45682200aaf1c9ea6541a0,
        0x7061cfe33ca6d2ed4b34d233dd6b7679303e3dba54c1ecbc9dd66ed3c7c4baf,
        0x710f49b7e8df1c456186e50a0bbfb243c375878cd13dcc139a86fc1c8264d21,
        0x308daefd63f467858aefa5ec5cb7d058283e8070e3dc000e45f5f4940776673,
        0x3df2752fba4efe5cb15260036ce1b612e3b29cb2964dcddac1e122c8f9509aa,
        0x7f2f051d8ec8fdb0c8dee260f8b4e3ad05c01a12ece713a083bafb24da45625,
        0x67143ac27e87e9566eed0b3466a1f55f99f20deda3a25e7ad9b4d7195a1ac73,
        0x70298d44938f4d6517c9b9eb0cff4ee8b5beff63911e0056d5b2324933f6949,
        0x1387957b24c356e8222f75ea4da66f61fe144ff0f2b95f4e40dd4b10b5aaf25,
        0x6ec0edda27a0939512f480f3b415c82333d13ab8705164aab365cf75c47c8ce,
        0x1eb199b7d9fb552cb834f0db134428aa70b3ee7dcf5ab34875c241ec627e317,
        0x37ff29a2d7847fba93162a38397f858f7b06cdd6859b76efb0bf5e65fef2190,
        0x7104cdbe3cc3cce0828686706bce2a0228254c45d3650bc94be03bb41d66d3e,
        0x4bc96036ff3a19256fe07c2916373293d5e8b079757ae3ae1037cd7d51cf655,
        0x212a83f96b4f57edcd91dcb038a9d093c617efbf1613ef1ce8e08349797676,
        0x3f0e6aab49f5bcd90419adeb4b7bdd2d531a4486e01c8ef6d2d2598728706a2,
        0x1ee1208c041b1c5bdbe9b7ef3df9987df49ce5e47766f23b124114ea890e41,
        0x7441697a9c7809e0966140adc058ca94c965d3bcc2556c177f564bee5843c43,
        0x1d2bed31d38f0bb971529008cd78739228308d7e3b5e7f3baff893d86850e7c,
        0x2e535956f2bd0bfbfff74c4a551fe2df4f7e0aaf5c49f0605c84bff80cea07e,
        0x660bcf371e3373813987d786f05bfb66083ea9afcab6d294172ba3cd259950a,
        0xcc35a77062ba2ef13ffc7e31aee95168cd9af4692c60422d8700038ab9507d,
        0x345ed09212b4dd27447376d39eb2f14ecbd2b83c1591fe7acc86d9c046137c9,
        0x230143419a5cfccc2c9bbf25a7efba6180a42b15426afe814b0759014c1c744,
        0x51f4d9f5d5dff9cd540da72ffa4388b4f8fc846a7d819fbae5b99c0347c37aa,
        0x783155d8dcd3aeca3284d8f4afb1284c137f2b0a4830e3a53333fd80b5bd852,
        0x764827d92072bf7dec5aea265077b5d7b341498f3f938c375d608d8c540b448,
        0x2a969ff7de7aa1e5ee3b8cfcd49f297d13d6da6a03922ca15da00f8aa44bc99,
        0x376d74d040ed461f64fe3da374096f943e9240008118f8401cc984332a405c5,
        0x784515276638b094a5a4fdf391ed09dd69f449215826f5e3538b73dc29c354b,
        0x42a6ae286f03c9ae45e892d3d1d71ba63810ef536a4042b75d50c173c756414,
        0x619a5ffbbfa79a69abd35c7055e422e3f2e45ee64ffe7e8b7f549738766e5fd,
        0x19fca6f0363a6f1dc99541c91cdcc350cc18967ff5a36dc02c872e99fe6c0f,
        0x2c14b1fdb5d7a48aea7492ed159c5d81d840fa0432aae997ddda57e2a7b51b9,
    ];

    let res = eval_composition_polynomial(
        interaction_elements,
        @public_input,
        mask_values.span(),
        constraint_coefficients.span(),
        point: 0x295db9e6b36bd5b5d2591d7d76a57e241821fd478b9f667778f0a09960d3a0f,
        trace_domain_size: 0x40000,
        trace_generator: 0x4768803ef85256034f67453635f87997ff61841e411ee63ce7b0a8b9745a046
    );
    assert(
        res == 0x245c787b658a0461241e840f1ffcf76ca5d29e6571e7a8edd80fdd968fddd45,
        'invalid composition_polynomial'
    );
}
